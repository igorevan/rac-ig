<div xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://hl7.org/fhir ../../input-cache/schemas/R5/fhir-single.xsd">
  <a name="integracao"></a>
  <h3>Integração com a RNDS</h3>
  <p> Para garantir a interoperabilidade entre as aplicações de Saúde Digital, em especial
    Prontuário(s) Eletrônico(s) do Paciente, portais e aplicações (<i>web e mobile</i>), a troca de
    informações ocorre por meio de serviços (<i>web services</i>) RESTful, desenvolvidos de acordo
    com o padrão <a href="https://hl7.org/FHIR/">FHIR R4</a>. </p>

  <a name="auxiliares"></a>
  <h3>Serviços Auxiliares</h3>
  <p>
    A seguir estão listados os serviços que irão auxiliar no envio da informação principal, o
    Registro de Atendimento Clínico.
  </p>
  <p>
  <table class="grid">
    <tbody>
      <tr>
        <td>
          <b>Serviço</b>
        </td>
        <td>
          <b>Componente</b>
        </td>
        <td>
          <b>Objetivo</b>
        </td>
      </tr>
      <tr>
        <td>GET@/fhir/r4/Patient</td>
        <td>EHR Services</td>
        <td>Permitir a pesquisa de pacientes</td>
      </tr>
      <tr>
        <td>GET@/fhir/r4/Organization</td>
        <td>EHR Services</td>
        <td>Permitir a pesquisa de estabelecimentos de Saúde </td>
      </tr>
      <tr>
        <td>GET@/fhir/r4/Practitioner</td>
        <td>EHR Services</td>
        <td>Permitir a pesquisa de profissionais de saúde</td>
      </tr>
      <tr>
        <td>GET@/fhir/r4/PractitionerRole</td>
        <td>EHR Services</td>
        <td>Permitir a pesquisa de perfis de profissionais de Saúde</td>
      </tr>
    </tbody>
  </table>
  </p>
  <p>
    Em relação ao serviço GET@/fhir/r4/Patient, quando não for possível captar o CPF ou CNS do
    cidadão/paciente, é importante que o sistema/solução capture os dados demográficos do usuário
    por meio eletrônico ou físico (nas fichas de registro regular do caso de uso). Desta forma,
    será possível realizar a busca demográfica ou a criação do CNS (CADSUS inserir endereço
    eletrônico) a ser
    utilizado como identificador do paciente no documento eletrônico.
  </p>

  <a name="principais"></a>
  <h3>Serviços Principais</h3>
  <p>
    A seguir estão listados os serviços que deverão ser usados para o envio ou consulta da
    informação principal, o Registro de Atendimento Clínico.
  </p>
  <p>
  <table class="grid">
    <tbody>
      <tr>
        <td>
          <b>Serviço</b>
        </td>
        <td>
          <b>Componente</b>
        </td>
        <td>
          <b>Objetivo</b>
        </td>
      </tr>
      <tr>
        <td>POST@/token</td>
        <td>EHR Auth</td>
        <td>Permitir autenticação com Certificado Digital do tipo e-CNPJ ou e-CPF (ICP Brasil)</td>
      </tr>
      <tr>
        <td>POST@/fhir/r4/Bundle</td>
        <td>EHR Services</td>
        <td>Permitir o envio (inclusão) de um documento clínico. Neste caso, é o Registro de
          Atendimento Clínico</td>
      </tr>
      <tr>
        <td>POST@/contexto-atendimento</td>
        <td>EHR Services</td>
        <td>Permitir a geração de um contexto de atendimento. Necessário para consultar documentos
          clínicos por meio do Conecte SUS Profissional</td>
      </tr>
      <tr>
        <td>DELETE@/fhir/r4/Bundle</td>
        <td>EHR Services</td>
        <td>Permitir a exclusão (delete) de um documento clínico</td>
      </tr>
    </tbody>
  </table>
  </p>

  <a name="exclusao"></a>
  <h3>Exclusão de Registros na RNDS</h3>
  <p>
    Recomenda-se que a transação para exclusão de registros (DELETE) somente seja efetuada nas
    seguintes situações:
  </p>
  <p>
  <ul>
    <li><b>1ª situação</b>: Paciente/cidadão errado. As informações registradas e enviadas não se
      referem ao cidadão vinculado ao documento clínico.</li>
    <li><b>2ª situação</b>: Registros duplicados. Foi enviado mais de um documento clínico
      contendo as mesmas informações sobre o mesmo evento e um mesmo paciente/cidadão. Neste caso,
      cabe ao integrador definir qual dos documentos se mantém e quais serão excluídos.</li>
  </ul>
  </p>
  <p>
    Como critério de segurança para efetivar a exclusão, será mantida a estrutura atual presente no
    FHIR,
    ou seja, o sistema de autorização irá considerar: UF, CNES, identificador do sistema
    (identifier.system) e
    o autor do documento (author). A estrutura FHIR deverá previamente verificar a existência do
    documento
    antes de realizar a ação de exclusão. Caso seja detectado que o documento não existe, a
    requisição
    será cancelada e apresentará o erro 404.
  </p>
  <p>
    O status do documento excluído será (entered-in-error) e o status do documento válido será
    (Final). Este
    registro não aparecerá mais nos resultados da pesquisa e as tentativas de ler o recurso falharão
    com
    uma resposta "HTTP 410 Gone" (ver 11.1 exemplos de consumo dos serviços).
  </p>
  <p>
    No diagrama de sequência, disposto na Figura 1, está descrito o fluxo para envio de um documento
    clínico.
  </p>
  <p>
    <b>Figura 1 - Diagrama de Sequência: Enviar Documento</b>
  </p>
  <div>

    <img height="600" src="enviarDocumento.png" alt="Diagrama de Sequência - Enviar Documento" />

  </div>
  <p>
    No diagrama de sequência, de acordo com Figura 2, está descrito o fluxo de geração do contexto
    de
    atendimento para consulta aos documentos clínicos de um paciente.
  </p>
  <p>
    <b>Figura 2 - Diagrama de Sequência: Consultar Timeline</b>
  </p>
  <div>

    <img height="600" src="consultarTimeline.png" alt="Diagrama de Sequência - Consultar Timeline" />

  </div>
  <p>
    <b>Nota</b>: <i>O <a href="https://conectesus.saude.gov.br/">Conecte SUS Profissional</a> é uma
      plataforma desenvolvida pelo Ministério da Saúde para materializar a Estratégia de Saúde para o
      Brasil, e tem como objetivo a troca de informações em saúde entre profissionais de saúde de toda
      a rede de atenção à saúde. Dessa forma, os profissionais acessam as informações de saúde de um
      determinado paciente a partir de seu histórico já padronizado, sempre dentro de um contexto de
      atendimento. O contexto de atendimento indica que o paciente passou por atendimento em um
      estabelecimento de saúde com um profissional de saúde.</i>
  </p>

  <a name="identificadores"></a>
  <h3>Identificadores do Registro Enviado a RNDS</h3>
  <p>
    Vale ressaltar que os registros são documentos computacionais, em formato JSON, compostos por
    perfis (profiles) do padrão FHIR R4. Cada registro enviado à RNDS possui dois identificadores:
  </p>
  <ul>
    <li>
      <p><b>Identificador atribuído pelo sistema de origem</b>: também chamado de identificador
        local, é o ID criado pelo sistema de origem para identificar univocamente o registro em sua
        base.</p>
      <p>
        No arquivo JSON, o identificador local deve ser informado no profile Bundle, propriedade
        identifier.value
      </p>

      <pre>
          <code>
            "identifier": {
                "system": "http://www.saude.gov.br/fhir/r4/NamingSystem/BRRNDS-1111",
                "value": "3112009-06246116057"
            }
          </code>
      </pre>

      <p>
        Em “system”, deve-se completar a URI “http://www.saude.gov.br/fhir/r4/NamingSystem/BRRNDS-
        com o número do identificador do solicitante (ver item 4.4 Identificador solicitante /
        Naming system).
      </p>
    </li>
    <li>
      <p>
        <b>Identificador atribuído pela RNDS</b>: também denominado de ID RNDS. Quando o registro é
        enviado com sucesso (header de resposta 201) à RNDS, no header location é gerada uma URL que
        é o identificador do registro na RNDS (ver Exemplos de consumo dos serviços).
      </p>
      <p>
        <b>IMPORTANTE</b>: os softwares integradores DEVEM SALVAR o identificador local e o ID RNDS
        para que possam realizar ações futuras como: pesquisa, substituição (ver item Substituição
        de registro na RNDS) e exclusão.
      </p>
    </li>
  </ul>

  <a name="ambientes"></a>
  <h3>Ambientes de Integração</h3>
  <p>Seguindo as boas práticas serão disponibilizados dois ambientes para a integração: homologação
    e produção.</p>

  <a name="homologacao"></a>
  <h4>Ambiente de Homologação</h4>
  <p>O ambiente de homologação tem como finalidade validar a integração, seus parâmetros de
    entradas,
    saídas e comportamentos negociais, permitindo a realização de testes antes da efetiva
    comunicação
    com o ambiente de produção. O ambiente de homologação é único, ou seja, todos os interessados
    em realizar o consumo dos serviços (web services) utilizarão o mesmo ambiente. Porém, mesmo
    usando o mesmo ambiente, as informações trafegadas (incluídas ou consultadas) estarão restritas
    aos estabelecimentos de saúde (CNES) elencados na etapa de credenciamento (capítulo 6 deste
    documento). Os endereços dos componentes de integração, no ambiente de homologação, são:</p>

  <ul>
    <li>
      <p>Utilizado para obtenção do token em ambiente de homologação:</p>
      <pre>
        <code>https://ehr-auth-hmg.saude.gov.br/api/</code>
      </pre>
    </li>
    <li>
      <p>
        Utilizado para comunicação com demais serviços do ambiente de Homologação:
      </p>
      <pre>
          <code>
            https://ehr-services.hmg.saude.gov.br/api/
          </code>
      </pre>
    </li>
  </ul>

  <a name="evidencias"></a>
  <h4>Evidências da Homologação</h4>
  <p>A partir dos testes realizados e da implementação local, serão aceitas como evidências dos
    testes em
    homologação um arquivo com:</p>
  <ul>
    <li>1 print do validador com sucesso;</li>
    <li>1 print header de resposta de criação do registro na RNDS;</li>
    <li>1 print do bundle enviado.</li>
  </ul>
  <p>Com essas evidências, o solicitante pode solicitar acesso ao ambiente de produção no Portal de
    Serviços.</p>

  <a name="producao"></a>
  <h3>Ambiente de Produção</h3>
  <p>O ambiente de produção é o ambiente estável e real que provê os serviços (web services) a serem
    consumidos. Para o ambiente produtivo, os integradores deverão acessar os endereços dos seus
    estados (UF). Durante o credenciamento (capítulo 6 deste documento), a credencial de acesso
    (Certificado Digital) será associada a um estabelecimento de saúde (CNES) (ou conjunto de
    estabelecimentos de saúde) no Portal de Serviços do DATASUS. Com isso, a credencial de acesso
    pertencerá a um estado (UF) específico. Acessos a estados diferentes não são permitidos e serão
    bloqueados automaticamente pelos serviços (web services). Os endereços dos componentes de
    integração, no ambiente de produção, por estado, são:</p>

  <table class="grid">
    <thead>
      <tr>
        <th>Estado</th>
        <th>Endpoint</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Acre</td>
        <td>https://ac-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Alagoas</td>
        <td>https://al-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Amapá</td>
        <td>https://ap-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Amazonas</td>
        <td>https://am-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Bahia</td>
        <td>https://ba-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Ceará</td>
        <td>https://ce-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Distrito Federal</td>
        <td>https://df-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Espírito Santo</td>
        <td>https://es-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Goiás</td>
        <td>https://go-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Maranhão</td>
        <td>https://ma-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Mato Grosso</td>
        <td>https://mt-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Mato Grosso do Sul</td>
        <td>https://ms-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Minas Gerais</td>
        <td>https://mg-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Pará</td>
        <td>https://pa-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Paraíba</td>
        <td>https://pb-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Paraná</td>
        <td>https://pr-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Pernambuco</td>
        <td>https://pe-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Piauí</td>
        <td>https://pi-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Rio de Janeiro</td>
        <td>https://rj-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Rio Grande do Norte</td>
        <td>https://rn-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Rio Grande do Sul</td>
        <td>https://rs-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Rondônia</td>
        <td>https://ro-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Roraima</td>
        <td>https://rr-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Santa Catarina</td>
        <td>https://sc-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>São Paulo</td>
        <td>https://sp-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Sergipe</td>
        <td>https://se-ehr-services.saude.gov.br/api/</td>
      </tr>
      <tr>
        <td>Tocantins</td>
        <td>https://to-ehr-services.saude.gov.br/api/</td>
      </tr>
    </tbody>
  </table>

</div>